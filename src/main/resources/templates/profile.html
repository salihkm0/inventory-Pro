<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
      lang="en">
<head th:replace="fragments/header :: head('User Profile')">
</head>
<body class="bg-gray-50">
    <!-- Include sidebar -->
    <div th:replace="fragments/sidebar :: body"></div>

    <!-- Main Content -->
    <div class="lg:ml-64 min-h-screen flex flex-col">
        <!-- Top Header -->
        <header class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-30">
            <div class="px-6 py-4">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-xl font-semibold text-gray-800">User Profile</h2>
                        <p class="text-gray-600 text-sm mt-1">Manage your account settings and preferences</p>
                    </div>
                   <!-- <div class="flex space-x-3">
                        <a th:href="@{/dashboard}" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center">
                            <i class="fas fa-arrow-left mr-2"></i>
                            Back to Dashboard
                        </a>
                    </div> -->
                </div>
            </div>
        </header>

        <!-- Page Content -->
        <main class="flex-1 p-6">
            <div class="max-w-4xl mx-auto">
                <!-- Profile Card -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 mb-6">
                    <div class="p-6 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-800">Profile Information</h3>
                        <p class="text-gray-600 text-sm mt-1">Your personal account details</p>
                    </div>
                    
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- User Avatar and Basic Info -->
                            <div class="flex items-center space-x-4">
                                <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user text-blue-600 text-2xl"></i>
                                </div>
                                <div>
                                    <h4 class="text-xl font-semibold text-gray-900" th:text="${username}">Username</h4>
                                    <div class="flex flex-wrap gap-1 mt-1">
                                        <span th:each="role : ${roles}" 
                                              class="px-2 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded-full">
                                            <span th:text="${role.authority}">ROLE_USER</span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Account Status -->
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h5 class="font-medium text-gray-700 mb-2">Account Status</h5>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Enabled:</span>
                                        <span th:class="${accountEnabled} ? 'text-green-600 font-medium' : 'text-red-600 font-medium'" 
                                              th:text="${accountEnabled} ? 'Active' : 'Inactive'">Active</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Account Non-Expired:</span>
                                        <span th:class="${accountNonExpired} ? 'text-green-600 font-medium' : 'text-red-600 font-medium'" 
                                              th:text="${accountNonExpired} ? 'Yes' : 'No'">Yes</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Credentials Non-Expired:</span>
                                        <span th:class="${credentialsNonExpired} ? 'text-green-600 font-medium' : 'text-red-600 font-medium'" 
                                              th:text="${credentialsNonExpired} ? 'Yes' : 'No'">Yes</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Account Non-Locked:</span>
                                        <span th:class="${accountNonLocked} ? 'text-green-600 font-medium' : 'text-red-600 font-medium'" 
                                              th:text="${accountNonLocked} ? 'Yes' : 'No'">Yes</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Additional User Info -->
                        <div class="mt-6 pt-6 border-t border-gray-200">
                            <h5 class="font-medium text-gray-700 mb-3">User Details</h5>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="text-sm text-gray-600">User ID</label>
                                    <p class="text-gray-900 font-medium" th:text="${username}">admin</p>
                                </div>
                                <div>
                                    <label class="text-sm text-gray-600">Email</label>
                                    <p class="text-gray-900 font-medium" th:text="${username + '@inventorypro.com'}">admin@inventorypro.com</p>
                                </div>
                                <div>
                                    <label class="text-sm text-gray-600">Authentication Type</label>
                                    <p class="text-gray-900 font-medium">Database Authentication</p>
                                </div>
                                <div>
                                    <label class="text-sm text-gray-600">Last Password Change</label>
                                    <p class="text-gray-900 font-medium" th:text="${memberSince}">January 2024</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Statistics Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200 text-center hover:shadow-md transition-shadow">
                        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                            <i class="fas fa-calendar-alt text-blue-600"></i>
                        </div>
                        <h4 class="text-lg font-semibold text-gray-900" th:text="${memberSince}">Jan 2024</h4>
                        <p class="text-gray-600 text-sm">Member Since</p>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200 text-center hover:shadow-md transition-shadow">
                        <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                            <i class="fas fa-sign-in-alt text-green-600"></i>
                        </div>
                        <h4 class="text-lg font-semibold text-gray-900" th:text="${lastLogin}">Now</h4>
                        <p class="text-gray-600 text-sm">Last Login</p>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200 text-center hover:shadow-md transition-shadow">
                        <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3">
                            <i class="fas fa-chart-line text-purple-600"></i>
                        </div>
                        <h4 class="text-lg font-semibold text-gray-900" th:text="${loginCount}">127</h4>
                        <p class="text-gray-600 text-sm">Total Logins</p>
                    </div>
                </div>

                <!-- System Information -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 mb-6">
                    <div class="p-6 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-800">System Information</h3>
                        <p class="text-gray-600 text-sm mt-1">Application and session details</p>
                    </div>
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h5 class="font-medium text-gray-700 mb-3">Application Info</h5>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Application Version:</span>
                                        <span class="text-gray-900 font-medium">v1.0.0</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Spring Boot:</span>
                                        <span class="text-gray-900 font-medium">2.7.0</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Java Version:</span>
                                        <span class="text-gray-900 font-medium">11</span>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h5 class="font-medium text-gray-700 mb-3">Session Info</h5>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Session ID:</span>
                                        <span class="text-gray-900 font-medium text-xs" th:text="${#session.id}">N/A</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Session Created:</span>
                                        <span class="text-gray-900 font-medium" th:text="${#session.creationTime} ?: 'Active'">Active</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Last Accessed:</span>
                                        <span class="text-gray-900 font-medium" th:text="${#session.lastAccessedTime} ?: 'Now'">Now</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                    <div class="p-6 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-800">Quick Actions</h3>
                        <p class="text-gray-600 text-sm mt-1">Manage your account and preferences</p>
                    </div>
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <a th:href="@{/settings}" class="bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-lg text-center transition-colors group">
                                <i class="fas fa-cog text-2xl mb-2 group-hover:scale-110 transition-transform"></i>
                                <div class="font-medium">Settings</div>
                                <div class="text-blue-100 text-xs mt-1">Update preferences</div>
                            </a>
                            <a th:href="@{/dashboard}" class="bg-green-600 hover:bg-green-700 text-white p-4 rounded-lg text-center transition-colors group">
                                <i class="fas fa-tachometer-alt text-2xl mb-2 group-hover:scale-110 transition-transform"></i>
                                <div class="font-medium">Dashboard</div>
                                <div class="text-green-100 text-xs mt-1">View overview</div>
                            </a>
                            <a th:href="@{/products}" class="bg-purple-600 hover:bg-purple-700 text-white p-4 rounded-lg text-center transition-colors group">
                                <i class="fas fa-boxes text-2xl mb-2 group-hover:scale-110 transition-transform"></i>
                                <div class="font-medium">Products</div>
                                <div class="text-purple-100 text-xs mt-1">Manage inventory</div>
                            </a>
                            <div class="bg-red-600 hover:bg-red-700 text-white p-4 rounded-lg text-center transition-colors group cursor-pointer" onclick="performLogout()">
                                <i class="fas fa-sign-out-alt text-2xl mb-2 group-hover:scale-110 transition-transform"></i>
                                <div class="font-medium">Logout</div>
                                <div class="text-red-100 text-xs mt-1">Sign out safely</div>
                            </div>
                        </div>

                        <!-- Additional Actions -->
                        <div class="mt-6 pt-6 border-t border-gray-200">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <a th:href="@{/products/reports}" class="bg-orange-500 hover:bg-orange-600 text-white p-3 rounded-lg text-center transition-colors group">
                                    <i class="fas fa-chart-pie text-xl mb-1 group-hover:scale-110 transition-transform"></i>
                                    <div class="font-medium text-sm">Reports</div>
                                </a>
                                <a th:href="@{/products/low-stock}" class="bg-yellow-500 hover:bg-yellow-600 text-white p-3 rounded-lg text-center transition-colors group">
                                    <i class="fas fa-exclamation-triangle text-xl mb-1 group-hover:scale-110 transition-transform"></i>
                                    <div class="font-medium text-sm">Low Stock</div>
                                </a>
                                <a th:href="@{/sales}" class="bg-indigo-500 hover:bg-indigo-600 text-white p-3 rounded-lg text-center transition-colors group">
                                    <i class="fas fa-shopping-cart text-xl mb-1 group-hover:scale-110 transition-transform"></i>
                                    <div class="font-medium text-sm">Sales</div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Hidden Logout Form -->
    <form id="logoutForm" th:action="@{/logout}" method="post" style="display: none;">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
    </form>

    <script>
        function performLogout() {
            if (confirm('Are you sure you want to logout?')) {
                // Show loading state
                const logoutButtons = document.querySelectorAll('[onclick="performLogout()"]');
                logoutButtons.forEach(btn => {
                    btn.innerHTML = '<i class="fas fa-spinner fa-spin text-xl mb-2"></i><div class="font-medium">Logging out...</div>';
                    btn.classList.remove('hover:bg-red-700');
                    btn.classList.add('bg-red-500');
                });
                
                // Submit the logout form
                document.getElementById('logoutForm').submit();
            }
        }

        // Add some interactive effects
        document.addEventListener('DOMContentLoaded', function() {
            // Add hover effects to cards
            const cards = document.querySelectorAll('.bg-white');
            cards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-2px)';
                });
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                });
            });

            // Add loading animation to quick action buttons
            const quickActions = document.querySelectorAll('.grid a, .grid div.cursor-pointer');
            quickActions.forEach(action => {
                action.addEventListener('click', function(e) {
                    if (!this.onclick || !this.onclick.toString().includes('performLogout')) {
                        // Add loading spinner for other actions
                        const originalContent = this.innerHTML;
                        this.innerHTML = '<i class="fas fa-spinner fa-spin text-xl mb-2"></i><div class="font-medium">Loading...</div>';
                        
                        setTimeout(() => {
                            this.innerHTML = originalContent;
                        }, 1000);
                    }
                });
            });
        });
    </script>

    <style>
        .bg-white {
            transition: all 0.3s ease;
        }
        
        .grid a, .grid div.cursor-pointer {
            transition: all 0.3s ease;
        }
        
        .grid a:hover, .grid div.cursor-pointer:hover {
            transform: translateY(-2px);
        }
        
        /* Role badge styles */
        .bg-blue-100 {
            background-color: #dbeafe;
        }
        
        .text-blue-800 {
            color: #1e40af;
        }
        
        /* Status indicator styles */
        .text-green-600 {
            color: #059669;
        }
        
        .text-red-600 {
            color: #dc2626;
        }
    </style>
</body>
</html>